var nt={qt:function(rt){if(rt.contentDocument){return rt.contentDocument;} else if(rt.contentWindow){return rt.contentWindow.document;} else if(rt.document){return rt.document;} else{return null;} } ,st:function(rt){var tt=this.qt(rt);tt.open();tt.write("<html><head>");tt.write("<link rel=\"stylesheet\" type=\"text/css\" media=\"all\" href=\""+ut.cssfile+"\" />");tt.write("</head><body bgcolor='#FFFFFF' text='#000000' link='#C28400' vlink='#C28400' alink='#C28400' marginwidth='0' marginheight='0' leftmargin='0' rightmargin='0' topmargin='0' bottommargin='0'>");tt.write("<table width='100%' cellspacing='0' cellpadding='0' border='0'><tr><td valign='top' class='message' id='content'></td></tr></table><a id='bottom'/>");tt.write("</body></html>");tt.close();rt.onload=function(){if(rt.ht){nt.qt(rt).getElementById('content').innerHTML+=rt.ht;nt.it(rt);} } ;} ,jt:function(rt,kt){var lt=this.qt(rt).getElementById('content');if(lt==null){if(!rt.ht)rt.ht="";rt.ht+=kt;} else{lt.innerHTML+=kt;} } ,it:function(rt){var ot=this.qt(rt).getElementById('bottom');if(myAgent=='opera'){rt.contentWindow.scrollTo(0,this.qt(rt).getElementById('content').clientHeight);} else if(ot)ot.scrollIntoView(false);} } ;sq.pt=mn.nn();mn.sn(sq.pt,sq.lq,{qn:function(pq){this.oq(pq);this.pq.onComplete=this.dt.on(this);this.pq.jr=this.et.on(this);this.pq.hr=this._q.on(this);this.pq.timeout=(3861+1139);this.ft={} ;this.frequency=(this.pq.frequency||2);this.gt=0;this.at=true;this.bt=true;this.ct=true;this.vt=this.pq.wt!=null;nt.st(this.pq.xt);if(this.pq.wt){this.pq.wt.onkeydown=this.yt.on(this);this.pq.wt.onfocus=(function(){this.ct=true;} ).on(this);this.pq.wt.onblur=(function(){this.ct=false;} ).on(this)} this.zt();} ,et:function($t,_t){this.mu("offline, reconnecting");this.nu();this.qu=setTimeout(this.zt.on(this),(973+27));} ,_q:function($t){this.mu("timeout, reconnecting");this.nu();this.qu=setTimeout(this.zt.on(this),(603+397));} ,ru:function(su){this.pq.fq='act='+su+'&thread='+(this.pq.threadid||0)+'&token='+(this.pq.token||0)+'&lastid='+(this.pq.tu||0);if(this.pq.user)this.pq.fq+="&user=true";if(su=='refresh'&&this.pq.wt&&this.pq.wt.value!='')this.pq.fq+="&typed=1";} ,uu:function(hu){if(this.pq.wt)this.pq.wt.disabled=!hu;} ,nu:function(){this.uu(true);if(this.ft.pq)this.ft.pq.onComplete=undefined;clearTimeout(this.qu);} ,zt:function(){this.ru("refresh");this.ft=new sq.vq(this.pq.servl,this.pq);} ,dt:function(hq){try{this.uu(true);this.at=true;var iu=sq.uq(hq);if(iu&&iu.tagName=='thread'){this.ju(iu);} else{this.ku(hq,iu,'refresh messages failed');} } catch(e){} this.bt=false;this.qu=setTimeout(this.zt.on(this),this.frequency*01750);} ,lu:function(ou){if(ou==""||!this.at){return;} this.at=false;this.nu();this.bt=true;this.ru("post");var pu={} .un(this.pq);pu.fq+="&message="+encodeURIComponent(ou);pu.onComplete=(function(du){this.dt(du);if(this.pq.wt){this.pq.wt.value='';this.pq.wt.focus();} } ).on(this);if(myRealAgent!='opera')this.uu(false);this.ft=new sq.vq(this.pq.servl,pu);} ,eu:function(fu){this.bt=true;new sq.vq(this.pq.servl,{fq:'act=rename&thread='+(this.pq.threadid||0)+'&token='+(this.pq.token||0)+'&name='+encodeURIComponent(fu)} );} ,gu:function(hq){var iu=sq.uq(hq);if(iu&&iu.tagName=='closed'){setTimeout('window.close()',(1389+611));} else{this.ku(hq,iu,'cannot close');} } ,au:function(){var bu='act=close&thread='+(this.pq.threadid||0)+'&token='+(this.pq.token||0);if(this.pq.user)bu+="&user=true";new sq.vq(this.pq.servl,{fq:bu,onComplete:this.gu.on(this)} );} ,cu:function(vu,wt){var wu=qs.us(wt);nt.jt(vu,wu);} ,xu:function(yu){if($("typingdiv")){$("typingdiv").style.display=yu?'inline':'none';} } ,zu:function($u){var _u=qs.us($u);if(this.pq.$u&&this.pq.user){this.pq.$u.innerHTML=_u!=""?"<img src=\""+ut.mh+"/images/free.gif\" width=\"7\" height=\"1\" border=\"0\" alt=\"\" /><img src=\""+_u+"\" border=\"0\" alt=\"\"/>":"";} } ,ju:function(iu){var nh=false;var qh=this.pq.xt;var rh=qs.ks(iu,"lastid");if(rh){this.pq.tu=rh;} var sh=qs.ks(iu,"typing");if(sh){this.xu(sh=='1');} var th=qs.ks(iu,"canpost");if(th){if(th=='1'&&!this.vt||this.vt&&th!='1'){window.location.href=window.location.href;} } for(var i=0;i<iu.childNodes.length;i++){var uh=iu.childNodes[i];if(uh.tagName=='message'){nh=true;this.cu(qh,uh);} else if(uh.tagName=='avatar'){this.zu(uh);} } if(window.location.search.indexOf('trace=on')>=0){var hu="updated";if(this.gt>0){var hh=((new Date()).getTime()-this.gt)/01750;hu=hu+", "+hh+" secs";if(hh>(9+1)){alert(hu);} } this.gt=(new Date()).getTime();this.mu(hu);} else{this.ih();} if(nh){nt.it(this.pq.xt);if(!this.bt){var jh=$('soundimg');if(jh==null||jh.className.match(new RegExp("\\bisound\\b"))){$s(ut.mh+'/sounds/new_message.wav');} } if(!this.ct){window.focus();} } } ,yt:function(k){if(k){kh=k.ctrlKey;k=k.which;} else{k=event.keyCode;kh=event.ctrlKey;} if(this.pq.wt&&((k==015&&(kh||myRealAgent=='opera'))||(k==012))){var lh=this.pq.wt.value;if(myRealAgent=='opera'){lh=lh.replace(/[\r\n]+$/,'');} this.lu(lh);return false;} return true;} ,ku:function(hq,iu,oh){if(iu&&iu.tagName=='error'){this.mu(qs.rs(iu,"descr"));} else{this.mu("reconnecting");} } ,ph:function(k){if($("engineinfo")){$("engineinfo").style.display='inline';$("engineinfo").innerHTML=k;} } ,mu:function(k){if(this.dh)clearTimeout(this.dh);this.ph(k);this.dh=setTimeout(this.ih.on(this),(2728+1272));} ,ih:function(){$("engineinfo").style.display='none';} } );eh=mn.nn();eh.prototype={qn:function(pq){this.pq=pq;this.fh=0;if(this.pq.gh&&this.pq.ah&&this.pq.bh){this.pq.bh.onmousedown=this.ch.on(this);this.pq.bh.onmouseup=this.vh.on(this);this.pq.bh.onmousemove=this.wh.on(this);} } ,ch:function(e){var or=e||event;if(this.pq.bh.setCapture)this.pq.bh.setCapture();this.xh=this.pq.gh.style.pixelHeight||this.pq.gh.clientHeight;this.yh=or.screenY;this.pq.zh=this.pq.gh.style.pixelHeight+this.pq.ah.clientHeight-this.pq.$h;this.fh=1;} ,vh:function(){if(this.fh){if(this.pq.bh.releaseCapture)this.pq.bh.releaseCapture();this.fh=0;} } ,wh:function(e){var or=e||event;if(this.fh){var _h=this.xh-(or.screenY-this.yh);if(_h>this.pq.zh)_h=this.pq.zh;else if(_h<this.pq.mi)_h=this.pq.mi;if(myAgent=='moz')this.pq.gh.style.height=_h+'px';else this.pq.gh.style.pixelHeight=_h;} } } ;var ut={ni:{} ,qi:{} ,ri:function(){ut.ni.eu($('uname').value);$('changename1').style.display='none';$('changename2').style.display='inline';$('unamelink').innerHTML=$('uname').value;} ,si:function(){$('changename1').style.display='inline';$('changename2').style.display='none';} } ;er.lr({'#postmessage a':function(ti){ti.onclick=function(){var wt=$('msgwnd');if(wt)ut.ni.lu(wt.value);} ;} ,'a#sndmessagelnk':function(ti){if(myRealAgent=='opera'){ti.innerHTML=ti.innerHTML.replace('Ctrl-','');} } ,'select#predefined':function(ti){ti.onchange=function(){var wt=$('msgwnd');if(this.selectedIndex!=0){wt.value=this.options[this.selectedIndex].innerText||this.options[this.selectedIndex].innerHTML;} this.selectedIndex=0;wt.focus();} ;} ,'div#changename2 a':function(ti){ti.onclick=function(){ut.si();return false;} ;} ,'div#changename1 a':function(ti){ti.onclick=function(){ut.ri();return false;} ;} ,'div#changename1 input#uname':function(ti){ti.onkeydown=function(e){var or=e||event;if(or.keyCode==(12+1)){ut.ri();} } ;} ,'a#refresh':function(ti){ti.onclick=function(){ut.ni.nu();ut.ni.zt();} ;} ,'a#togglesound':function(ti){ti.onclick=function(){var jh=$('soundimg');if(!jh){return;} if(jh.className.match(new RegExp("\\bisound\\b"))){jh.className="tplimage inosound";} else{jh.className="tplimage isound";} var ui=$('msgwnd');if(ui)ui.focus();} ;} ,'a.closethread':function(ti){ti.onclick=function(){ut.ni.au();} ;} } );kr.lr(window,'onload',function(){ut.mh=threadParams.wroot;ut.cssfile=threadParams.cssfile;ut.qi=new eh({bh:$("spl1"),gh:$("msgwndtd"),ah:$("chatwndtd"),mi:0x1e,$h:036} );ut.ni=new sq.pt(({xt:myRealAgent=='safari'?self.frames[0]:$("chatwnd"),$u:$("avatarwnd"),wt:$("msgwnd")} ).un(threadParams||{} ));} );